{
  "updatedAt": "2026-03-01T14:17:56.191Z",
  "createdAt": "2026-02-12T08:00:08.087Z",
  "id": "3LE3BnPfHSuIZCVR",
  "name": "Error Notification",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.errorTrigger",
      "typeVersion": 1,
      "position": [
        224,
        304
      ],
      "name": "Error Trigger",
      "id": "aba1f1f6-bc98-4a9f-856f-7a99d7477455"
    },
    {
      "parameters": {
        "jsCode": "// ====== é…ç½® ======\nconst TELEGRAM_CHAT_ID = '135590865';\nconst RATE_LIMIT_SECONDS = 300;\nconst SILENT_HOURS_START = 23;\nconst SILENT_HOURS_END = 8;\nconst MIN_ERROR_LEVEL = 'error';\n\n// ====== è·å–é”™è¯¯æ•°æ® ======\nconst errorData = $input.item.json;\nconst workflowName = errorData.workflow?.name || 'Unknown';\nconst errorLevel = errorData.execution?.error?.level || 'info';\nconst errorMsg = errorData.execution?.error?.message || 'No message';\nconst executionId = errorData.execution?.id;\nconst executionUrl = errorData.execution?.url;\nconst lastNodeExecuted = errorData.execution?.lastNodeExecuted;\nconst errorName = errorData.execution?.error?.name;\nconst mode = errorData.execution?.mode;\n\n// ====== é”™è¯¯çº§åˆ«è¿‡æ»¤ ======\nconst errorLevels = ['info', 'warning', 'error', 'critical'];\nconst currentLevelIndex = errorLevels.indexOf(errorLevel.toLowerCase());\nconst minLevelIndex = errorLevels.indexOf(MIN_ERROR_LEVEL.toLowerCase());\n\nif (currentLevelIndex < minLevelIndex) {\n  return [{ json: { shouldSend: false, reason: `Level '${errorLevel}' below threshold` } }];\n}\n\n// ====== é™é»˜æ—¶æ®µæ£€æŸ¥ ======\nconst now = new Date();\nconst hour = now.getUTCHours();\nconst isSilentHour = hour >= SILENT_HOURS_START || hour < SILENT_HOURS_END;\n\n// ====== é¢‘ç‡é™åˆ¶ ======\nconst staticData = $getWorkflowStaticData('global');\nconst rateLimitKey = `lastNotification_${workflowName}`;\nconst lastNotification = staticData[rateLimitKey] ? new Date(staticData[rateLimitKey]) : null;\nconst nowTime = now.getTime();\n\nlet shouldSend = true;\nlet reason = '';\n\nif (lastNotification) {\n  const secondsSinceLast = (nowTime - lastNotification.getTime()) / 1000;\n  if (secondsSinceLast < RATE_LIMIT_SECONDS) {\n    shouldSend = false;\n    reason = `Rate limited: ${Math.round(RATE_LIMIT_SECONDS - secondsSinceLast)}s remaining`;\n  }\n}\n\n// ====== æ„å»ºæ¶ˆæ¯ ======\nconst silentNote = isSilentHour ? 'ğŸŒ™ [é™é»˜æ—¶æ®µ]' : '';\n\nconst message = `# n8n æµç¨‹æŠ¥é”™ ${silentNote}\n- From: n8n.vps.ntlx.top\n- Workflow: ${workflowName}\n\n## æ‰§è¡Œä¿¡æ¯\n- Mode: ${mode}\n- Level: ${errorLevel}\n- Node: ${lastNodeExecuted}\n- Error: ${errorName}\n- Message: ${errorMsg}\n\n## é“¾æ¥\n- Execution ID: ${executionId}\n- URL: ${executionUrl}`;\n\n// ====== è¿”å›ç»“æœ ======\nif (shouldSend) {\n  staticData[rateLimitKey] = nowTime;\n  return [{ json: { shouldSend: true, message: message, chatId: TELEGRAM_CHAT_ID, workflowName: workflowName, silent: isSilentHour } }];\n} else {\n  return [{ json: { shouldSend: false, reason: reason, workflowName: workflowName } }];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        224,
        0
      ],
      "name": "Filter & Rate Limit",
      "id": "ac55e3fa-cb94-4f26-b1a4-f4b09477d6d6"
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.shouldSend }}",
              "value2": true
            }
          ]
        }
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        448,
        0
      ],
      "name": "Should Send?",
      "id": "c285f1cb-5645-428a-af2e-27c7d7bacc9e"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "disable_notification": "={{ $json.silent }}"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        672,
        -64
      ],
      "name": "Send Notification",
      "id": "4dd1c3b6-9137-4ec5-bd32-360c6004fecc",
      "webhookId": "c6d07374-17c4-48b7-bfa0-a20768198d8e",
      "credentials": {
        "telegramApi": {
          "id": "tVb8Nv4w2KsUp66k",
          "name": "lx3325360"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const data = $input.item.json;\nconsole.log(`[Filtered] ${data.workflowName}: ${data.reason}`);\nreturn [];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        672,
        128
      ],
      "name": "Log Filtered",
      "id": "873e8ba5-c31b-477e-945b-01d3eb3af1a8"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json }}",
        "messages": {
          "messageValues": [
            {
              "message": "=# Role\nä½ æ˜¯ä¸€ä¸ªèµ„æ·±çš„ n8n è‡ªåŠ¨åŒ–å·¥ä½œæµè¿ç»´ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ¥æ”¶ n8n Error Trigger ä¼ æ¥çš„ JSON æ ¼å¼æŠ¥é”™ä¿¡æ¯ï¼Œæå–å…³é”®æ•°æ®ï¼Œå¹¶å°†å…¶æ€»ç»“ã€ç¿»è¯‘ã€æ’ç‰ˆä¸ºä¸€æ¡é«˜åº¦å¯è¯»çš„ Discord æ¶ˆæ¯ã€‚\n\n# Objectives\n1. **å¿«é€Ÿå®šä½**ï¼šè®©ç”¨æˆ·åœ¨ 3 ç§’å†…çŸ¥é“æ˜¯å“ªä¸ªå·¥ä½œæµã€å“ªä¸ªèŠ‚ç‚¹æŒ‚äº†ã€‚\n2. **é€šä¿—æ˜“æ‡‚**ï¼šå°†æŠ€æœ¯æ€§çš„æŠ¥é”™ï¼ˆå¦‚ HTTP 429, NodeApiErrorï¼‰ç¿»è¯‘/æ€»ç»“ä¸ºæ™®é€šäººèƒ½å¬æ‡‚çš„å¤§ç™½è¯ã€‚\n3. **æä¾›è¡ŒåŠ¨æŒ‡å—**ï¼šåŸºäºæŠ¥é”™å†…å®¹ï¼Œç»™å‡ºå…·ä½“çš„ã€å¯è½åœ°çš„è§£å†³å»ºè®®ã€‚\n4. **é€‚é… Discord**ï¼šå……åˆ†åˆ©ç”¨ Discord çš„ Markdown è¯­æ³•ï¼ˆåŠ ç²—ã€ä»£ç å—ã€å¼•ç”¨ã€Emojiï¼‰ä¼˜åŒ–é˜…è¯»ä½“éªŒã€‚\n\n# Workflow & Guidelines\nå½“ä½ æ”¶åˆ°ä¸€æ®µ JSON æŠ¥é”™ä¿¡æ¯æ—¶ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å¤„ç†ï¼š\n1. **æå–å…³é”®ä¿¡æ¯**ï¼š\n   - å·¥ä½œæµåç§° (`workflow.name`)\n   - å¤±è´¥èŠ‚ç‚¹ (`execution.lastNodeExecuted` æˆ– `error.node.name`)\n   - é”™è¯¯çŠ¶æ€ç  (`error.httpCode`)\n   - é”™è¯¯æè¿° (`error.message`, `error.description`, `error.messages`)\n   - æ‰§è¡Œæ—¥å¿—é“¾æ¥ (`execution.url`)\n2. **ç¿»è¯‘ä¸æ€»ç»“**ï¼šå°†æ ¸å¿ƒçš„è‹±æ–‡æŠ¥é”™ç¿»è¯‘ä¸ºæµç•…çš„ä¸­æ–‡ï¼Œå¹¶åˆå¹¶å†—ä½™ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼šå°† \"The service is receiving too many requests from you\" å’Œ \"æ‚¨å·²å—åˆ°é€Ÿç‡é™åˆ¶\" æ€»ç»“ä¸º \"API è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè§¦å‘äº†ç›®æ ‡æœåŠ¡çš„é€Ÿç‡é™åˆ¶ (Rate Limit)\"ï¼‰ã€‚\n3. **æ™ºèƒ½è¯Šæ–­**ï¼šæ ¹æ®æŠ¥é”™ç±»å‹æ¨æµ‹åŸå› å¹¶ç»™å‡ºå»ºè®®ï¼ˆä¾‹å¦‚é‡åˆ° 429ï¼Œå»ºè®®å¢åŠ èŠ‚ç‚¹ç­‰å¾…æ—¶é—´/æ’é˜Ÿå¤„ç†ï¼›é‡åˆ° 401 å»ºè®®æ£€æŸ¥ Token ç­‰ï¼‰ã€‚\n\n# Output Format (Discord Markdown Template)\nè¯·ä¸¥æ ¼ä½¿ç”¨ä»¥ä¸‹æ ¼å¼è¾“å‡ºæ¶ˆæ¯ï¼ˆä¸è¦è¾“å‡º JSONï¼Œç›´æ¥è¾“å‡ºè¿™æ®µ Discord æ–‡æœ¬ï¼‰ï¼š\n\nğŸš¨ **[å·¥ä½œæµåç§°] è¿è¡Œå¤±è´¥**\n> **å‡ºé”™èŠ‚ç‚¹**ï¼š`[å‡ºé”™çš„èŠ‚ç‚¹åç§°]`\n> **å‘ç”Ÿæ—¶é—´**ï¼š[å°†æ—¶é—´æˆ³è½¬åŒ–ä¸º YYYY-MM-DD HH:mm æ ¼å¼]\n\nâš ï¸ **é”™è¯¯è¯¦æƒ…**\n* **çŠ¶æ€ç **ï¼š`[HTTP Code]` | `[Error Name]`\n* **é—®é¢˜æè¿°**ï¼š[ç”¨é€šä¿—æ˜“æ‡‚çš„ä¸­æ–‡æ€»ç»“æŠ¥é”™åŸå› ]\n* **åŸå§‹ä¿¡æ¯**ï¼š\n```json\n[æå–æ ¸å¿ƒçš„ error message æˆ– stack å‰ä¸¤è¡Œï¼Œä¿æŒç®€çŸ­]"
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.9,
      "position": [
        432,
        304
      ],
      "id": "68ad7c71-467e-42c0-9262-d21e9b6c3235",
      "name": "Basic LLM Chain",
      "retryOnFail": true,
      "waitBetweenTries": 2000
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "qwen3.5-plus",
          "mode": "list",
          "cachedResultName": "qwen3.5-plus"
        },
        "responsesApiEnabled": false,
        "options": {
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        496,
        496
      ],
      "id": "537f0570-a71e-4208-8da2-dadfadf72b9a",
      "name": "OpenAI Chat Model",
      "retryOnFail": true,
      "waitBetweenTries": 2000,
      "credentials": {
        "openAiApi": {
          "id": "gyuAIYPDLYyRYJh7",
          "name": "NewAPI-OE"
        }
      }
    },
    {
      "parameters": {
        "inputText": "={{ $json.text }}",
        "categories": {
          "categories": [
            {
              "category": "True",
              "description": "è¡¨æ˜éœ€è¦å°†æŠ¥é”™ä¿¡æ¯å‘ç»™ç”¨æˆ·"
            },
            {
              "category": "False",
              "description": "è¡¨æ˜ä¸éœ€è¦å°†æŠ¥é”™ä¿¡æ¯å‘ç»™ç”¨æˆ·"
            }
          ]
        },
        "options": {
          "systemPromptTemplate": "=# Role\nä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½çš„ n8n å·¥ä½œæµé”™è¯¯åˆ†å‘è·¯ç”±ï¼ˆError Triage Agentï¼‰ã€‚ä½ çš„ä»»åŠ¡æ˜¯åˆ†æ n8n è¿è¡Œå¤±è´¥åäº§ç”Ÿçš„ JSON æŠ¥é”™æ•°æ®ï¼Œå¹¶åˆ¤æ–­è¯¥é”™è¯¯æ˜¯å¦éœ€è¦ç«‹å³å‘é€é€šçŸ¥è®©äººå·¥ä»‹å…¥å¤„ç†ã€‚\n\n# Classification Categories\nä½ å¿…é¡»å°†é”™è¯¯åˆ†ç±»ä¸ºä»¥ä¸‹ä¸¤ä¸ªç»“æœä¹‹ä¸€ï¼š\n- **True**ï¼šéœ€è¦é€šçŸ¥ç”¨æˆ·ï¼ˆéœ€è¦äººå·¥å¹²é¢„ã€ä¿®å¤æˆ–å…³æ³¨çš„ä¸¥é‡é”™è¯¯ï¼‰ã€‚\n- **False**ï¼šä¸éœ€è¦é€šçŸ¥ç”¨æˆ·ï¼ˆå¯ä»¥å¿½ç•¥çš„ç¬æ—¶é”™è¯¯ã€ç³»ç»Ÿå¯è‡ªæ„ˆçš„æ³¢åŠ¨ã€æˆ–ä½çº§åˆ«çš„è­¦å‘Šï¼‰ã€‚\n\n# Evaluation Rules\nè¯·ä»”ç»†é˜…è¯» JSON ä¸­çš„ `error.httpCode`, `error.message`, `error.name` å’Œ `error.level`ï¼Œå¹¶æŒ‰ç…§ä»¥ä¸‹è§„åˆ™è¿›è¡Œè¯„ä¼°ï¼š\n\n## åˆ¤ä¸º True (éœ€è¦é€šçŸ¥) çš„æƒ…å†µï¼š\n1. **èº«ä»½éªŒè¯ä¸æƒé™å¤±è´¥**ï¼šå¦‚ HTTP 401 (Unauthorized), 403 (Forbidden)ã€‚è¯´æ˜ Token è¿‡æœŸæˆ– API Key å¤±æ•ˆï¼Œå¿…é¡»äººå·¥æ›´æ–°ã€‚\n2. **å·¥ä½œæµé€»è¾‘/é…ç½®é”™è¯¯**ï¼šå¦‚ HTTP 400 (Bad Request)ï¼Œç¼ºå°‘å¿…è¦å‚æ•°ï¼Œå˜é‡è§£æå¤±è´¥ï¼Œè¯­æ³•é”™è¯¯ï¼ˆSyntaxError, TypeError, ReferenceErrorï¼‰ã€‚\n3. **èµ„æºä¸å­˜åœ¨**ï¼šå¦‚ HTTP 404 (Not Found)ï¼Œè¯´æ˜ç›®æ ‡ç«¯ç‚¹æˆ–æ•°æ®æºç»“æ„å·²æ›´æ”¹ã€‚\n4. **é…é¢è€—å°½/ä¸¥é‡é™æµ**ï¼šå¦‚ HTTP 429 (Too Many Requests)ï¼Œä¸”æ˜ç¡®æç¤ºè´¦æˆ·é¢åº¦è€—å°½ï¼Œæˆ–ä¸¥é‡é˜»æ–­äº†æ ¸å¿ƒä¸šåŠ¡ï¼Œéœ€è¦äººå·¥è°ƒæ•´èŠ‚ç‚¹è§¦å‘é¢‘ç‡ï¼ˆå¦‚å¢åŠ  Wait èŠ‚ç‚¹ï¼‰ã€‚\n\n## åˆ¤ä¸º False (å¿½ç•¥é€šçŸ¥) çš„æƒ…å†µï¼š\n1. **è½»å¾®è­¦å‘Š (Warning)**ï¼šå¦‚æœ JSON ä¸­ `\"level\": \"warning\"`ï¼Œä¸”ä¸æ˜¯è‡´å‘½ä¸­æ–­ï¼Œé€šå¸¸ä¸å½±å“å¤§å±€ã€‚\n2. **ç¬æ—¶ç½‘ç»œæŠ–åŠ¨**ï¼šå¦‚ HTTP 502 (Bad Gateway), 503 (Service Unavailable), 504 (Gateway Timeout), ECONNRESET, socket hang upã€‚è¿™ç±»é”™è¯¯é€šå¸¸åœ¨ n8n èŠ‚ç‚¹çš„è‡ªåŠ¨é‡è¯• (Auto-retry) æœºåˆ¶ä¸‹ä¼šè‡ªè¡Œè§£å†³ã€‚\n3. **æçŸ­çš„é€Ÿç‡é™åˆ¶**ï¼šå¦‚ HTTP 429 ä¸”æç¤º `retry_after` åªæœ‰å‡ ç§’æˆ–é›¶ç‚¹å‡ ç§’ï¼ˆä¾‹å¦‚ 0.3 ç§’ï¼‰ï¼Œè¿™å±äºæ­£å¸¸çš„ API èŠ‚æµï¼Œä¸éœ€è¦äººç±»ææ…Œã€‚\n\n# Task\nè¯·åˆ†æä¼ å…¥çš„ JSON æ•°æ®ã€‚åŸºäºä¸Šè¿°è§„åˆ™ï¼Œæ€è€ƒè¿™å±äºå“ªç§æƒ…å†µã€‚\næœ€åï¼Œ**ä»…è¾“å‡ºç±»åˆ«åç§°ï¼ˆTrue æˆ– Falseï¼‰ï¼Œä¸è¦è¾“å‡ºä»»ä½•å…¶ä»–å¤šä½™çš„è§£é‡Šæ–‡å­—æˆ–æ ‡ç‚¹ç¬¦å·ã€‚**"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1.1,
      "position": [
        928,
        -64
      ],
      "id": "13925e0f-8337-4738-a2f4-e4f58cb1865a",
      "name": "Text Classifier"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "smart-regular",
          "mode": "list",
          "cachedResultName": "smart-regular"
        },
        "responsesApiEnabled": false,
        "options": {
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        1008,
        128
      ],
      "id": "b8645e6b-4a32-45df-9515-d51db6d1a3c5",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "BtNUoaYPZrKSsCA2",
          "name": "NewAPI-VPS"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1264,
        16
      ],
      "id": "768bfb50-be08-4187-94bc-40f1c7640daa",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "resource": "message",
        "guildId": {
          "__rl": true,
          "value": "1223272555885105264",
          "mode": "id"
        },
        "channelId": {
          "__rl": true,
          "value": "1224990958718812170",
          "mode": "list",
          "cachedResultName": "service-status",
          "cachedResultUrl": "https://discord.com/channels/1223272555885105264/1224990958718812170"
        },
        "content": "={{ $json.text }}",
        "options": {}
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        784,
        304
      ],
      "id": "79e60af0-8edc-4a75-93bb-a02315ef2213",
      "name": "Send a message",
      "webhookId": "32359dd1-65c8-496a-ab0b-d53b85eb58c2",
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "credentials": {
        "discordOAuth2Api": {
          "id": "ep3LAXJ2M9XUjEj1",
          "name": "NTLx"
        }
      }
    }
  ],
  "connections": {
    "Error Trigger": {
      "main": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter & Rate Limit": {
      "main": [
        [
          {
            "node": "Should Send?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Should Send?": {
      "main": [
        [
          {
            "node": "Send Notification",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log Filtered",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Text Classifier",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Text Classifier": {
      "main": [
        [],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "timeSavedMode": "fixed",
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "saveExecutionProgress": false,
    "saveManualExecutions": false,
    "binaryMode": "separate",
    "timeSavedPerExecution": 5
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "fc32e907-4837-4ffa-9608-6f26bff581f5",
  "activeVersionId": "fc32e907-4837-4ffa-9608-6f26bff581f5",
  "triggerCount": 0,
  "shared": [
    {
      "updatedAt": "2026-02-12T08:00:08.087Z",
      "createdAt": "2026-02-12T08:00:08.087Z",
      "role": "workflow:owner",
      "workflowId": "3LE3BnPfHSuIZCVR",
      "projectId": "cNMj0K6AdJmi0OAZ"
    }
  ],
  "activeVersion": {
    "updatedAt": "2026-03-01T14:17:26.717Z",
    "createdAt": "2026-03-01T14:17:22.635Z",
    "versionId": "fc32e907-4837-4ffa-9608-6f26bff581f5",
    "workflowId": "3LE3BnPfHSuIZCVR",
    "nodes": [
      {
        "parameters": {},
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          224,
          304
        ],
        "name": "Error Trigger",
        "id": "aba1f1f6-bc98-4a9f-856f-7a99d7477455"
      },
      {
        "parameters": {
          "jsCode": "// ====== é…ç½® ======\nconst TELEGRAM_CHAT_ID = '135590865';\nconst RATE_LIMIT_SECONDS = 300;\nconst SILENT_HOURS_START = 23;\nconst SILENT_HOURS_END = 8;\nconst MIN_ERROR_LEVEL = 'error';\n\n// ====== è·å–é”™è¯¯æ•°æ® ======\nconst errorData = $input.item.json;\nconst workflowName = errorData.workflow?.name || 'Unknown';\nconst errorLevel = errorData.execution?.error?.level || 'info';\nconst errorMsg = errorData.execution?.error?.message || 'No message';\nconst executionId = errorData.execution?.id;\nconst executionUrl = errorData.execution?.url;\nconst lastNodeExecuted = errorData.execution?.lastNodeExecuted;\nconst errorName = errorData.execution?.error?.name;\nconst mode = errorData.execution?.mode;\n\n// ====== é”™è¯¯çº§åˆ«è¿‡æ»¤ ======\nconst errorLevels = ['info', 'warning', 'error', 'critical'];\nconst currentLevelIndex = errorLevels.indexOf(errorLevel.toLowerCase());\nconst minLevelIndex = errorLevels.indexOf(MIN_ERROR_LEVEL.toLowerCase());\n\nif (currentLevelIndex < minLevelIndex) {\n  return [{ json: { shouldSend: false, reason: `Level '${errorLevel}' below threshold` } }];\n}\n\n// ====== é™é»˜æ—¶æ®µæ£€æŸ¥ ======\nconst now = new Date();\nconst hour = now.getUTCHours();\nconst isSilentHour = hour >= SILENT_HOURS_START || hour < SILENT_HOURS_END;\n\n// ====== é¢‘ç‡é™åˆ¶ ======\nconst staticData = $getWorkflowStaticData('global');\nconst rateLimitKey = `lastNotification_${workflowName}`;\nconst lastNotification = staticData[rateLimitKey] ? new Date(staticData[rateLimitKey]) : null;\nconst nowTime = now.getTime();\n\nlet shouldSend = true;\nlet reason = '';\n\nif (lastNotification) {\n  const secondsSinceLast = (nowTime - lastNotification.getTime()) / 1000;\n  if (secondsSinceLast < RATE_LIMIT_SECONDS) {\n    shouldSend = false;\n    reason = `Rate limited: ${Math.round(RATE_LIMIT_SECONDS - secondsSinceLast)}s remaining`;\n  }\n}\n\n// ====== æ„å»ºæ¶ˆæ¯ ======\nconst silentNote = isSilentHour ? 'ğŸŒ™ [é™é»˜æ—¶æ®µ]' : '';\n\nconst message = `# n8n æµç¨‹æŠ¥é”™ ${silentNote}\n- From: n8n.vps.ntlx.top\n- Workflow: ${workflowName}\n\n## æ‰§è¡Œä¿¡æ¯\n- Mode: ${mode}\n- Level: ${errorLevel}\n- Node: ${lastNodeExecuted}\n- Error: ${errorName}\n- Message: ${errorMsg}\n\n## é“¾æ¥\n- Execution ID: ${executionId}\n- URL: ${executionUrl}`;\n\n// ====== è¿”å›ç»“æœ ======\nif (shouldSend) {\n  staticData[rateLimitKey] = nowTime;\n  return [{ json: { shouldSend: true, message: message, chatId: TELEGRAM_CHAT_ID, workflowName: workflowName, silent: isSilentHour } }];\n} else {\n  return [{ json: { shouldSend: false, reason: reason, workflowName: workflowName } }];\n}"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          224,
          0
        ],
        "name": "Filter & Rate Limit",
        "id": "ac55e3fa-cb94-4f26-b1a4-f4b09477d6d6"
      },
      {
        "parameters": {
          "conditions": {
            "boolean": [
              {
                "value1": "={{ $json.shouldSend }}",
                "value2": true
              }
            ]
          }
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 1,
        "position": [
          448,
          0
        ],
        "name": "Should Send?",
        "id": "c285f1cb-5645-428a-af2e-27c7d7bacc9e"
      },
      {
        "parameters": {
          "chatId": "={{ $json.chatId }}",
          "text": "={{ $json.message }}",
          "additionalFields": {
            "disable_notification": "={{ $json.silent }}"
          }
        },
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          672,
          -64
        ],
        "name": "Send Notification",
        "id": "4dd1c3b6-9137-4ec5-bd32-360c6004fecc",
        "webhookId": "c6d07374-17c4-48b7-bfa0-a20768198d8e",
        "credentials": {
          "telegramApi": {
            "id": "tVb8Nv4w2KsUp66k",
            "name": "lx3325360"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const data = $input.item.json;\nconsole.log(`[Filtered] ${data.workflowName}: ${data.reason}`);\nreturn [];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          672,
          128
        ],
        "name": "Log Filtered",
        "id": "873e8ba5-c31b-477e-945b-01d3eb3af1a8"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json }}",
          "messages": {
            "messageValues": [
              {
                "message": "=# Role\nä½ æ˜¯ä¸€ä¸ªèµ„æ·±çš„ n8n è‡ªåŠ¨åŒ–å·¥ä½œæµè¿ç»´ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ¥æ”¶ n8n Error Trigger ä¼ æ¥çš„ JSON æ ¼å¼æŠ¥é”™ä¿¡æ¯ï¼Œæå–å…³é”®æ•°æ®ï¼Œå¹¶å°†å…¶æ€»ç»“ã€ç¿»è¯‘ã€æ’ç‰ˆä¸ºä¸€æ¡é«˜åº¦å¯è¯»çš„ Discord æ¶ˆæ¯ã€‚\n\n# Objectives\n1. **å¿«é€Ÿå®šä½**ï¼šè®©ç”¨æˆ·åœ¨ 3 ç§’å†…çŸ¥é“æ˜¯å“ªä¸ªå·¥ä½œæµã€å“ªä¸ªèŠ‚ç‚¹æŒ‚äº†ã€‚\n2. **é€šä¿—æ˜“æ‡‚**ï¼šå°†æŠ€æœ¯æ€§çš„æŠ¥é”™ï¼ˆå¦‚ HTTP 429, NodeApiErrorï¼‰ç¿»è¯‘/æ€»ç»“ä¸ºæ™®é€šäººèƒ½å¬æ‡‚çš„å¤§ç™½è¯ã€‚\n3. **æä¾›è¡ŒåŠ¨æŒ‡å—**ï¼šåŸºäºæŠ¥é”™å†…å®¹ï¼Œç»™å‡ºå…·ä½“çš„ã€å¯è½åœ°çš„è§£å†³å»ºè®®ã€‚\n4. **é€‚é… Discord**ï¼šå……åˆ†åˆ©ç”¨ Discord çš„ Markdown è¯­æ³•ï¼ˆåŠ ç²—ã€ä»£ç å—ã€å¼•ç”¨ã€Emojiï¼‰ä¼˜åŒ–é˜…è¯»ä½“éªŒã€‚\n\n# Workflow & Guidelines\nå½“ä½ æ”¶åˆ°ä¸€æ®µ JSON æŠ¥é”™ä¿¡æ¯æ—¶ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å¤„ç†ï¼š\n1. **æå–å…³é”®ä¿¡æ¯**ï¼š\n   - å·¥ä½œæµåç§° (`workflow.name`)\n   - å¤±è´¥èŠ‚ç‚¹ (`execution.lastNodeExecuted` æˆ– `error.node.name`)\n   - é”™è¯¯çŠ¶æ€ç  (`error.httpCode`)\n   - é”™è¯¯æè¿° (`error.message`, `error.description`, `error.messages`)\n   - æ‰§è¡Œæ—¥å¿—é“¾æ¥ (`execution.url`)\n2. **ç¿»è¯‘ä¸æ€»ç»“**ï¼šå°†æ ¸å¿ƒçš„è‹±æ–‡æŠ¥é”™ç¿»è¯‘ä¸ºæµç•…çš„ä¸­æ–‡ï¼Œå¹¶åˆå¹¶å†—ä½™ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼šå°† \"The service is receiving too many requests from you\" å’Œ \"æ‚¨å·²å—åˆ°é€Ÿç‡é™åˆ¶\" æ€»ç»“ä¸º \"API è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè§¦å‘äº†ç›®æ ‡æœåŠ¡çš„é€Ÿç‡é™åˆ¶ (Rate Limit)\"ï¼‰ã€‚\n3. **æ™ºèƒ½è¯Šæ–­**ï¼šæ ¹æ®æŠ¥é”™ç±»å‹æ¨æµ‹åŸå› å¹¶ç»™å‡ºå»ºè®®ï¼ˆä¾‹å¦‚é‡åˆ° 429ï¼Œå»ºè®®å¢åŠ èŠ‚ç‚¹ç­‰å¾…æ—¶é—´/æ’é˜Ÿå¤„ç†ï¼›é‡åˆ° 401 å»ºè®®æ£€æŸ¥ Token ç­‰ï¼‰ã€‚\n\n# Output Format (Discord Markdown Template)\nè¯·ä¸¥æ ¼ä½¿ç”¨ä»¥ä¸‹æ ¼å¼è¾“å‡ºæ¶ˆæ¯ï¼ˆä¸è¦è¾“å‡º JSONï¼Œç›´æ¥è¾“å‡ºè¿™æ®µ Discord æ–‡æœ¬ï¼‰ï¼š\n\nğŸš¨ **[å·¥ä½œæµåç§°] è¿è¡Œå¤±è´¥**\n> **å‡ºé”™èŠ‚ç‚¹**ï¼š`[å‡ºé”™çš„èŠ‚ç‚¹åç§°]`\n> **å‘ç”Ÿæ—¶é—´**ï¼š[å°†æ—¶é—´æˆ³è½¬åŒ–ä¸º YYYY-MM-DD HH:mm æ ¼å¼]\n\nâš ï¸ **é”™è¯¯è¯¦æƒ…**\n* **çŠ¶æ€ç **ï¼š`[HTTP Code]` | `[Error Name]`\n* **é—®é¢˜æè¿°**ï¼š[ç”¨é€šä¿—æ˜“æ‡‚çš„ä¸­æ–‡æ€»ç»“æŠ¥é”™åŸå› ]\n* **åŸå§‹ä¿¡æ¯**ï¼š\n```json\n[æå–æ ¸å¿ƒçš„ error message æˆ– stack å‰ä¸¤è¡Œï¼Œä¿æŒç®€çŸ­]"
              }
            ]
          },
          "batching": {}
        },
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "typeVersion": 1.9,
        "position": [
          432,
          304
        ],
        "id": "68ad7c71-467e-42c0-9262-d21e9b6c3235",
        "name": "Basic LLM Chain",
        "retryOnFail": true,
        "waitBetweenTries": 2000
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "qwen3.5-plus",
            "mode": "list",
            "cachedResultName": "qwen3.5-plus"
          },
          "responsesApiEnabled": false,
          "options": {
            "temperature": 0
          }
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.3,
        "position": [
          496,
          496
        ],
        "id": "537f0570-a71e-4208-8da2-dadfadf72b9a",
        "name": "OpenAI Chat Model",
        "retryOnFail": true,
        "waitBetweenTries": 2000,
        "credentials": {
          "openAiApi": {
            "id": "gyuAIYPDLYyRYJh7",
            "name": "NewAPI-OE"
          }
        }
      },
      {
        "parameters": {
          "inputText": "={{ $json.text }}",
          "categories": {
            "categories": [
              {
                "category": "True",
                "description": "è¡¨æ˜éœ€è¦å°†æŠ¥é”™ä¿¡æ¯å‘ç»™ç”¨æˆ·"
              },
              {
                "category": "False",
                "description": "è¡¨æ˜ä¸éœ€è¦å°†æŠ¥é”™ä¿¡æ¯å‘ç»™ç”¨æˆ·"
              }
            ]
          },
          "options": {
            "systemPromptTemplate": "=# Role\nä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½çš„ n8n å·¥ä½œæµé”™è¯¯åˆ†å‘è·¯ç”±ï¼ˆError Triage Agentï¼‰ã€‚ä½ çš„ä»»åŠ¡æ˜¯åˆ†æ n8n è¿è¡Œå¤±è´¥åäº§ç”Ÿçš„ JSON æŠ¥é”™æ•°æ®ï¼Œå¹¶åˆ¤æ–­è¯¥é”™è¯¯æ˜¯å¦éœ€è¦ç«‹å³å‘é€é€šçŸ¥è®©äººå·¥ä»‹å…¥å¤„ç†ã€‚\n\n# Classification Categories\nä½ å¿…é¡»å°†é”™è¯¯åˆ†ç±»ä¸ºä»¥ä¸‹ä¸¤ä¸ªç»“æœä¹‹ä¸€ï¼š\n- **True**ï¼šéœ€è¦é€šçŸ¥ç”¨æˆ·ï¼ˆéœ€è¦äººå·¥å¹²é¢„ã€ä¿®å¤æˆ–å…³æ³¨çš„ä¸¥é‡é”™è¯¯ï¼‰ã€‚\n- **False**ï¼šä¸éœ€è¦é€šçŸ¥ç”¨æˆ·ï¼ˆå¯ä»¥å¿½ç•¥çš„ç¬æ—¶é”™è¯¯ã€ç³»ç»Ÿå¯è‡ªæ„ˆçš„æ³¢åŠ¨ã€æˆ–ä½çº§åˆ«çš„è­¦å‘Šï¼‰ã€‚\n\n# Evaluation Rules\nè¯·ä»”ç»†é˜…è¯» JSON ä¸­çš„ `error.httpCode`, `error.message`, `error.name` å’Œ `error.level`ï¼Œå¹¶æŒ‰ç…§ä»¥ä¸‹è§„åˆ™è¿›è¡Œè¯„ä¼°ï¼š\n\n## åˆ¤ä¸º True (éœ€è¦é€šçŸ¥) çš„æƒ…å†µï¼š\n1. **èº«ä»½éªŒè¯ä¸æƒé™å¤±è´¥**ï¼šå¦‚ HTTP 401 (Unauthorized), 403 (Forbidden)ã€‚è¯´æ˜ Token è¿‡æœŸæˆ– API Key å¤±æ•ˆï¼Œå¿…é¡»äººå·¥æ›´æ–°ã€‚\n2. **å·¥ä½œæµé€»è¾‘/é…ç½®é”™è¯¯**ï¼šå¦‚ HTTP 400 (Bad Request)ï¼Œç¼ºå°‘å¿…è¦å‚æ•°ï¼Œå˜é‡è§£æå¤±è´¥ï¼Œè¯­æ³•é”™è¯¯ï¼ˆSyntaxError, TypeError, ReferenceErrorï¼‰ã€‚\n3. **èµ„æºä¸å­˜åœ¨**ï¼šå¦‚ HTTP 404 (Not Found)ï¼Œè¯´æ˜ç›®æ ‡ç«¯ç‚¹æˆ–æ•°æ®æºç»“æ„å·²æ›´æ”¹ã€‚\n4. **é…é¢è€—å°½/ä¸¥é‡é™æµ**ï¼šå¦‚ HTTP 429 (Too Many Requests)ï¼Œä¸”æ˜ç¡®æç¤ºè´¦æˆ·é¢åº¦è€—å°½ï¼Œæˆ–ä¸¥é‡é˜»æ–­äº†æ ¸å¿ƒä¸šåŠ¡ï¼Œéœ€è¦äººå·¥è°ƒæ•´èŠ‚ç‚¹è§¦å‘é¢‘ç‡ï¼ˆå¦‚å¢åŠ  Wait èŠ‚ç‚¹ï¼‰ã€‚\n\n## åˆ¤ä¸º False (å¿½ç•¥é€šçŸ¥) çš„æƒ…å†µï¼š\n1. **è½»å¾®è­¦å‘Š (Warning)**ï¼šå¦‚æœ JSON ä¸­ `\"level\": \"warning\"`ï¼Œä¸”ä¸æ˜¯è‡´å‘½ä¸­æ–­ï¼Œé€šå¸¸ä¸å½±å“å¤§å±€ã€‚\n2. **ç¬æ—¶ç½‘ç»œæŠ–åŠ¨**ï¼šå¦‚ HTTP 502 (Bad Gateway), 503 (Service Unavailable), 504 (Gateway Timeout), ECONNRESET, socket hang upã€‚è¿™ç±»é”™è¯¯é€šå¸¸åœ¨ n8n èŠ‚ç‚¹çš„è‡ªåŠ¨é‡è¯• (Auto-retry) æœºåˆ¶ä¸‹ä¼šè‡ªè¡Œè§£å†³ã€‚\n3. **æçŸ­çš„é€Ÿç‡é™åˆ¶**ï¼šå¦‚ HTTP 429 ä¸”æç¤º `retry_after` åªæœ‰å‡ ç§’æˆ–é›¶ç‚¹å‡ ç§’ï¼ˆä¾‹å¦‚ 0.3 ç§’ï¼‰ï¼Œè¿™å±äºæ­£å¸¸çš„ API èŠ‚æµï¼Œä¸éœ€è¦äººç±»ææ…Œã€‚\n\n# Task\nè¯·åˆ†æä¼ å…¥çš„ JSON æ•°æ®ã€‚åŸºäºä¸Šè¿°è§„åˆ™ï¼Œæ€è€ƒè¿™å±äºå“ªç§æƒ…å†µã€‚\næœ€åï¼Œ**ä»…è¾“å‡ºç±»åˆ«åç§°ï¼ˆTrue æˆ– Falseï¼‰ï¼Œä¸è¦è¾“å‡ºä»»ä½•å…¶ä»–å¤šä½™çš„è§£é‡Šæ–‡å­—æˆ–æ ‡ç‚¹ç¬¦å·ã€‚**"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "typeVersion": 1.1,
        "position": [
          928,
          -64
        ],
        "id": "13925e0f-8337-4738-a2f4-e4f58cb1865a",
        "name": "Text Classifier"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "smart-regular",
            "mode": "list",
            "cachedResultName": "smart-regular"
          },
          "responsesApiEnabled": false,
          "options": {
            "temperature": 0
          }
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.3,
        "position": [
          1008,
          128
        ],
        "id": "b8645e6b-4a32-45df-9515-d51db6d1a3c5",
        "name": "OpenAI Chat Model1",
        "credentials": {
          "openAiApi": {
            "id": "BtNUoaYPZrKSsCA2",
            "name": "NewAPI-VPS"
          }
        }
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          1264,
          16
        ],
        "id": "768bfb50-be08-4187-94bc-40f1c7640daa",
        "name": "No Operation, do nothing"
      },
      {
        "parameters": {
          "authentication": "oAuth2",
          "resource": "message",
          "guildId": {
            "__rl": true,
            "value": "1223272555885105264",
            "mode": "id"
          },
          "channelId": {
            "__rl": true,
            "value": "1224990958718812170",
            "mode": "list",
            "cachedResultName": "service-status",
            "cachedResultUrl": "https://discord.com/channels/1223272555885105264/1224990958718812170"
          },
          "content": "={{ $json.text }}",
          "options": {}
        },
        "type": "n8n-nodes-base.discord",
        "typeVersion": 2,
        "position": [
          784,
          304
        ],
        "id": "79e60af0-8edc-4a75-93bb-a02315ef2213",
        "name": "Send a message",
        "webhookId": "32359dd1-65c8-496a-ab0b-d53b85eb58c2",
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "credentials": {
          "discordOAuth2Api": {
            "id": "ep3LAXJ2M9XUjEj1",
            "name": "NTLx"
          }
        }
      }
    ],
    "connections": {
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Basic LLM Chain",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter & Rate Limit": {
        "main": [
          [
            {
              "node": "Should Send?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Should Send?": {
        "main": [
          [
            {
              "node": "Send Notification",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Filtered",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Basic LLM Chain",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Basic LLM Chain": {
        "main": [
          [
            {
              "node": "Send a message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model1": {
        "ai_languageModel": [
          [
            {
              "node": "Text Classifier",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Text Classifier": {
        "main": [
          [],
          [
            {
              "node": "No Operation, do nothing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Administrator NTLx",
    "name": "Version fc32e907",
    "description": "",
    "autosaved": true
  },
  "tags": []
}